# CLAUDE.md â€” å–µå–µé‡‘å¹£å±‹ é–‹ç™¼ç­†è¨˜

## ç‰ˆæœ¬ç´€éŒ„

| ç‰ˆæœ¬    | æ—¥æœŸ       | èªªæ˜ |
|---------|------------|------|
| 2.1.3   | 2026-03-01 | æ–°å¢ç´€éŒ„ç·¨è¼¯/åˆªé™¤åŠŸèƒ½ï¼›ç™¼ç¥¨æƒææ–°å¢æ—¥æœŸè¾¨è­˜èˆ‡æ—¥æœŸç·¨è¼¯ |
| 2.1.2   | â€”          | åŸå§‹ç‰ˆæœ¬ |

---

## æ¶æ§‹æ‘˜è¦

```
lib/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ transaction.dart   # Transaction / TxCategory / Wish / TransactionType
â”‚   â”œâ”€â”€ account.dart       # Accountï¼ˆå¤šå¸³è™Ÿï¼‰
â”‚   â””â”€â”€ constants.dart     # kCategoriesã€kAccessoriesã€è²“å’ªé£¢é¤“å¸¸æ•¸
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ app_state.dart     # å…¨åŸŸç‹€æ…‹ï¼ˆProvider + ChangeNotifierï¼‰
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ home_screen.dart         # ä¸»ç•«é¢ï¼šå­˜éŒ¢/èŠ±éŒ¢/æƒæå…¥å£
â”‚   â”œâ”€â”€ history_screen.dart      # å®Œæ•´ç´€éŒ„ï¼ˆå«ç·¨è¼¯/åˆªé™¤ï¼‰
â”‚   â”œâ”€â”€ receipt_scan_screen.dart # ç™¼ç¥¨æƒæè¨˜å¸³ï¼ˆå«æ—¥æœŸè¾¨è­˜èˆ‡ç·¨è¼¯ï¼‰
â”‚   â”œâ”€â”€ stats_screen.dart        # çµ±è¨ˆï¼šé€±åœ–è¡¨ã€é¡åˆ¥åœ“é¤…
â”‚   â”œâ”€â”€ accessories_screen.dart  # é…ä»¶è§£é–èˆ‡è£å‚™
â”‚   â”œâ”€â”€ dream_tree_screen.dart   # é¡˜æœ›æ¨¹ï¼ˆå­˜æ¬¾ç›®æ¨™ï¼‰
â”‚   â”œâ”€â”€ parent_screen.dart       # å®¶é•·å„€è¡¨æ¿
â”‚   â”œâ”€â”€ more_screen.dart         # æ›´å¤šè¨­å®š
â”‚   â””â”€â”€ amount_input_screen.dart # é‡‘é¡è¼¸å…¥ï¼ˆé¢é¡æŒ‰éˆ•ï¼‰
â”œâ”€â”€ widgets/
â”‚   â””â”€â”€ building_scene.dart      # å»ºç¯‰å ´æ™¯å…ƒä»¶ï¼ˆç›®å‰æœªæ›å…¥ä»»ä½•ç•«é¢ï¼‰
â””â”€â”€ utils/
    â”œâ”€â”€ receipt_parser.dart        # æ¢ä»¶åŒ¯å‡ºï¼ˆmobile / stubï¼‰
    â”œâ”€â”€ receipt_parser_mobile.dart # ML Kit OCR å¯¦ä½œï¼ˆiOS/Androidï¼‰
    â”œâ”€â”€ receipt_parser_stub.dart   # Web ä½”ä½å¯¦ä½œ
    â”œâ”€â”€ export_helper.dart         # CSV åŒ¯å‡º
    â”œâ”€â”€ sound_service.dart         # éŸ³æ•ˆ
    â””â”€â”€ version.dart               # appVersion å¸¸æ•¸
```

---

## åŠŸèƒ½èªªæ˜

### ç•«é¢èˆ‡åŠŸèƒ½ä¸€è¦½

| ç•«é¢ | åŠŸèƒ½é‡é» |
|------|----------|
| **ä¸»ç•«é¢** `home_screen.dart` | å­˜éŒ¢ / èŠ±éŒ¢ / æƒæç™¼ç¥¨å…¥å£ï¼›è²“å’ªå‹•ç•«èˆ‡å¿ƒæƒ…è¨Šæ¯ |
| **å®Œæ•´ç´€éŒ„** `history_screen.dart` | ä¾æ—¥æœŸåˆ†çµ„åˆ—è¡¨ï¼›é»æ“Šé–‹å•Ÿç·¨è¼¯é¢æ¿ï¼ˆv2.1.3ï¼‰ |
| **ç™¼ç¥¨æƒæ** `receipt_scan_screen.dart` | ML Kit OCR + Taiwan é›»å­ç™¼ç¥¨ QRï¼›æ—¥æœŸè¾¨è­˜ï¼ˆv2.1.3ï¼‰ |
| **çµ±è¨ˆ** `stats_screen.dart` | 7 æ—¥æ”¶æ”¯é•·æ¢åœ–ï¼›é¡åˆ¥åœ“é¤…åœ– |
| **é…ä»¶** `accessories_screen.dart` | 8 ä»¶é…ä»¶ä¾é€£çºŒå¤©æ•¸æˆ–å­˜æ¬¾è§£é–ï¼›å¯è£å‚™/å¸é™¤ |
| **é¡˜æœ›æ¨¹** `dream_tree_screen.dart` | è‡ªè¨‚å­˜æ¬¾ç›®æ¨™ï¼›ä»¥ã€Œæ¾†æ°´ã€åˆ†é…å­˜æ¬¾ï¼›å››æ®µæ¨¹æˆé•·åœ–ç¤º |
| **å®¶é•·å„€è¡¨æ¿** `parent_screen.dart` | æ‘˜è¦å¡ï¼ˆé€£çºŒè¨˜å¸³å¤©æ•¸ / é¤˜é¡ / ç¸½æ”¶å…¥ï¼‰ï¼›å¾…å¯©æ ¸æ¸…å–®ï¼›åˆ©æ¯è¨­å®š |
| **æ›´å¤š** `more_screen.dart` | å¸³è™Ÿåˆ‡æ› / æ–°å¢ / åˆªé™¤ï¼›è³‡æ–™åŒ¯å‡ºï¼›å…¶ä»–è¨­å®š |

---

### ç´€éŒ„ç·¨è¼¯èˆ‡åˆªé™¤ï¼ˆv2.1.3ï¼‰

**ä½ç½®**ï¼š`lib/screens/history_screen.dart`

- åœ¨ã€Œå®Œæ•´ç´€éŒ„ã€é é¢ï¼Œé»æ“Šä»»æ„ä¸€ç­†ç´€éŒ„å³å¯é–‹å•Ÿåº•éƒ¨ç·¨è¼¯é¢æ¿ã€‚
- å¯ä¿®æ”¹æ¬„ä½ï¼š
  - **é‡‘é¡**ï¼ˆç´”æ•¸å­—ï¼‰
  - **é¡å‹**ï¼ˆæ”¶å…¥ / æ”¯å‡ºï¼‰
  - **é¡åˆ¥**ï¼ˆä¾é¡å‹å‹•æ…‹æ›´æ–°é¸é …ï¼‰
  - **å‚™è¨»**
  - **æ—¥æœŸ**ï¼ˆæ—¥æœŸé¸æ“‡å™¨ï¼‰
  - **æ™‚é–“**ï¼ˆæ™‚é–“é¸æ“‡å™¨ï¼‰
- é»æ“Šå³ä¸Šè§’ ğŸ—‘ï¸ åˆªé™¤æŒ‰éˆ•ï¼Œç¢ºèªå¾Œæ°¸ä¹…ç§»é™¤è©²ç­†ç´€éŒ„ã€‚
- å„²å­˜å¾Œè‡ªå‹•é‡æ–°è¨ˆç®—é¤˜é¡ç­‰è¡ç”Ÿæ•¸å€¼ã€‚

**ç›¸é—œæ”¹å‹•**ï¼š
- `lib/models/transaction.dart`ï¼š`amount`ã€`category`ã€`type`ã€`note`ã€`createdAt` æ¬„ä½æ”¹ç‚ºå¯ä¿®æ”¹ï¼ˆç§»é™¤ `final`ï¼‰ã€‚
- `lib/providers/app_state.dart`ï¼šæ–°å¢ `updateTransaction()` åŠ `deleteTransaction()` æ–¹æ³•ï¼›`addTransaction()` æ–°å¢å¯é¸åƒæ•¸ `customDate`ã€‚

---

### ç™¼ç¥¨æƒææ—¥æœŸè¾¨è­˜èˆ‡ç·¨è¼¯ï¼ˆv2.1.3ï¼‰

**ä½ç½®**ï¼š`lib/screens/receipt_scan_screen.dart`ã€`lib/utils/receipt_parser_mobile.dart`

- OCR è¾¨è­˜ç™¼ç¥¨æ™‚ï¼Œç¾åœ¨åŒæ™‚å˜—è©¦è¾¨è­˜æ¶ˆè²»æ—¥æœŸã€‚
- æ”¯æ´æ ¼å¼ï¼š
  - è¥¿å…ƒå¹´ï¼š`2025/03/15`ã€`2025-03-15`ã€`2025å¹´03æœˆ15æ—¥`
  - æ°‘åœ‹å¹´ï¼š`114/03/15`ã€`114-03-15`ã€`114å¹´03æœˆ15æ—¥`
- è¾¨è­˜åˆ°çš„æ—¥æœŸæœƒé¡¯ç¤ºã€Œè‡ªå‹•è¾¨è­˜ã€æ¨™ç±¤ï¼Œä¸¦é å¡«åˆ°æ—¥æœŸæ¬„ä½ã€‚
- è‹¥æœªè¾¨è­˜åˆ°æ—¥æœŸï¼Œé è¨­ç‚ºä»Šå¤©ã€‚
- ä½¿ç”¨è€…å¯åœ¨ç¢ºèªé é¢é»æ“Šæ—¥æœŸæ¬„ä½ï¼Œç”¨æ—¥æœŸé¸æ“‡å™¨è‡ªè¡Œä¿®æ”¹ã€‚
- æœ€çµ‚è¨˜å¸³æ™‚ä»¥ä½¿ç”¨è€…ç¢ºèªçš„æ—¥æœŸç‚ºæº–ï¼ˆ`customDate` åƒæ•¸ï¼‰ã€‚

**ç›¸é—œæ”¹å‹•**ï¼š
- `lib/utils/receipt_parser_mobile.dart`ï¼š`ReceiptData` æ–°å¢ `date` æ¬„ä½ï¼›æ–°å¢ `_extractDate()` éœæ…‹æ–¹æ³•ã€‚
- `lib/utils/receipt_parser_stub.dart`ï¼š`ReceiptData` åŒæ­¥æ–°å¢ `date` æ¬„ä½ï¼ˆWeb stubï¼‰ã€‚

---

## ç‹€æ…‹ç®¡ç†ï¼ˆapp_state.dartï¼‰

### ä¸»è¦ç‹€æ…‹æ¬„ä½

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `_transactions` | `List<Transaction>` | æ‰€æœ‰äº¤æ˜“ç´€éŒ„ |
| `_wishes` | `List<Wish>` | å­˜æ¬¾ç›®æ¨™æ¸…å–® |
| `_streak` | `int` | é€£çºŒè¨˜å¸³å¤©æ•¸ |
| `_catHunger` | `double` | è²“å’ªé£¢é¤“å€¼ï¼ˆ0â€“100ï¼‰ |
| `_unlockedAccessories` | `List<String>` | å·²è§£é–é…ä»¶ ID |
| `_equippedAccessories` | `List<String>` | å·²è£å‚™é…ä»¶ ID |
| `_interestRate` | `double` | åˆ©ç‡ï¼ˆ%ï¼‰ |
| `_interestPeriod` | `String` | `'weekly'` æˆ– `'monthly'` |
| `_accounts` | `List<Account>` | å¤šå¸³è™Ÿæ¸…å–® |
| `_buildingLevel` | `int` | å»ºç¯‰ç­‰ç´šï¼ˆå…§éƒ¨è¨ˆç®—ï¼›**ç›®å‰ç„¡ç•«é¢é¡¯ç¤º**ï¼‰ |

> âš ï¸ **`buildingLevel`**ï¼šåœ¨ `app_state.dart` å…§éƒ¨ä»æœƒæ ¹æ“šå­˜æ¬¾è‡ªå‹•æ›´æ–°ï¼Œ`widgets/building_scene.dart` ä¹Ÿå­˜åœ¨å°æ‡‰å…ƒä»¶ï¼Œä½†**ç›®å‰æ²’æœ‰ä»»ä½•ç•«é¢å¼•ç”¨æ­¤æ•¸å€¼æˆ–å…ƒä»¶**ï¼Œå±¬æ–¼å¾…æ•´åˆç‹€æ…‹ã€‚

### é—œéµæ–¹æ³•

| æ–¹æ³• | èªªæ˜ |
|------|------|
| `addTransaction(amount, category, type, note, {customDate})` | æ–°å¢äº¤æ˜“ï¼Œå¯æŒ‡å®šæ—¥æœŸ |
| `updateTransaction(id, {amount, category, type, note, createdAt})` | ä¿®æ”¹æ—¢æœ‰äº¤æ˜“ |
| `deleteTransaction(id)` | åˆªé™¤äº¤æ˜“ |
| `approveTransaction(id)` | å®¶é•·å¯©æ ¸é€šé |
| `sendHeart(id)` | å®¶é•·é€æ„›å¿ƒ |
| `addWish / waterWish / deleteWish` | é¡˜æœ›ç®¡ç† |
| `toggleAccessory(id)` | è£å‚™ / å¸é™¤é…ä»¶ |
| `applyInterest()` | ä¾è¨­å®šç™¼æ”¾åˆ©æ¯ |
| `addAccount / switchAccount / renameAccount / deleteAccount` | å¤šå¸³è™Ÿç®¡ç† |

---

## éŠæˆ²åŒ–æ©Ÿåˆ¶

### è²“å’ªé£¢é¤“ç³»çµ±
- æ¯å¤©è‡ªå‹•è¡°æ¸› 15 é»ï¼ˆ`kHungerDecayPerDay`ï¼‰
- æ¯ç­†è¨˜å¸³æ¢å¾© 30 é»ï¼ˆ`kHungerFeedAmount`ï¼‰
- è¶…é 1 å¤©æœªè¨˜å¸³å‰‡é€£çºŒå¤©æ•¸æ­¸é›¶

### é€£çºŒè¨˜å¸³å¤©æ•¸ï¼ˆStreakï¼‰
- æ¯æ—¥é¦–æ¬¡è¨˜å¸³ +1 å¤©
- è¶…é 1 å¤©æœªè¨˜å¸³é‡ç½®ç‚º 1

### é…ä»¶è§£é–ï¼ˆ8 ä»¶ï¼‰

| é…ä»¶ | è§£é–æ¢ä»¶ |
|------|----------|
| ğŸ”” ç´…è‰²éˆ´éº | é€£çºŒ 3 å¤© |
| ğŸ§£ è—è‰²åœå…œ | é€£çºŒ 7 å¤© |
| ğŸ‘‘ é‡‘è‰²çš‡å†  | é€£çºŒ 14 å¤© |
| ğŸ•¶ï¸ æ˜Ÿæ˜Ÿçœ¼é¡ | é€£çºŒ 30 å¤© |
| ğŸ›ï¸ è²“å’ªå°çª© | å­˜æ¬¾ â‰¥ $200 |
| ğŸ  å°é­šç©å…· | å­˜æ¬¾ â‰¥ $500 |
| ğŸ—¼ è±ªè¯è²“å¡” | å­˜æ¬¾ â‰¥ $1000 |
| âœ¨ é­”æ³•æ£’ | å­˜æ¬¾ â‰¥ $3000 |

---

## è³‡æ–™æŒä¹…åŒ–

ä½¿ç”¨ `SharedPreferences`ï¼Œä»¥å¸³è™Ÿç‚ºå–®ä½å„²å­˜ï¼š

```
'accounts'            â†’ List<Account> JSON
'current_account'     â†’ ç›®å‰å¸³è™Ÿ ID
'account_{id}'        â†’ {
  transactions, wishes, lastRecordDate, streak,
  catHunger, buildingLevel, unlockedAccessories,
  equippedAccessories, interestRate, interestPeriod
}
```

èˆŠç‰ˆ `'app_state'` key å¯è‡ªå‹•é·ç§»è‡³æ–°æ ¼å¼ã€‚

---

## é–‹ç™¼è¦ç¯„

- æ¯æ¬¡åŠŸèƒ½è®Šæ›´é ˆåŒæ™‚æ›´æ–°ï¼š
  - `lib/utils/version.dart`ï¼ˆ`appVersion`ï¼‰
  - `pubspec.yaml`ï¼ˆ`version: X.Y.Z+N`ï¼‰
  - æœ¬æª”æ¡ˆï¼ˆ`CLAUDE.md`ï¼‰ç‰ˆæœ¬ç´€éŒ„è¡¨æ ¼
- ç‰ˆæœ¬è™Ÿè¦å‰‡ï¼š`major.minor.patch+build`
  - `patch` éå¢ï¼šå°åŠŸèƒ½ã€bug fix
  - `minor` éå¢ï¼šæ–°åŠŸèƒ½æ¨¡çµ„
  - `build` æ¯æ¬¡ç™¼ä½ˆéå¢
